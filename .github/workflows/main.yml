name: CI

on:
  push:
    branches:
    - master
  pull_request:
    branches:
    - master

jobs:
  test_micromamba_win:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest]
    steps:
      - name: Install micromamba
        shell: powershell
          # Set-UseUnsafeHeaderParsing -Enable
          # Invoke-Webrequest -URI https://micromamba.snakepit.net/api/micromamba/win-64/latest -OutFile micromamba.tar.bz2
        run: |
          Invoke-Webrequest -URI https://anaconda.org/conda-forge/micromamba/0.5.2/download/win-64/micromamba-0.5.2-ha925a31_0.tar.bz2 -OutFile micromamba.tar.bz2
          C:\PROGRA~1\7-Zip\7z.exe x micromamba.tar.bz2 -aoa
          C:\PROGRA~1\7-Zip\7z.exe x micromamba.tar -ttar -aoa -r Library\bin\micromamba.exe
          MOVE -Force Library\bin\micromamba.exe micromamba.exe
          REMOVE-ITEM -Force -Recurse Library
          RM micromamba.tar.bz2
          RM micromamba.tar
      - name: Run micromamba
        shell: powershell
        run: |
          $Env:CI=1
          $Env:MAMBA_ROOT_PREFIX=Get-Location
          .\micromamba
          .\micromamba create -y -p $Env:MAMBA_ROOT_PREFIX xtensor -c conda-forge